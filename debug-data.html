<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Debug - Raw Tournament Data</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .tournament-section {
            margin-bottom: 40px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .tournament-header {
            background: #d4af37;
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 6px 6px 0 0;
        }
        
        .round-section {
            margin-bottom: 25px;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 15px;
            background: white;
        }
        
        .round-header {
            background: #2c5234;
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 4px 4px 0 0;
            font-weight: bold;
        }
        
        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .table-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            background: #fafafa;
        }
        
        .table-header {
            font-weight: bold;
            color: #2c5234;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        
        .partnership {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .partnership.winner {
            background: #e8f5e8;
            border-left: 3px solid #4caf50;
        }
        
        .partnership.loser {
            background: #ffeaea;
            border-left: 3px solid #f44336;
        }
        
        .players {
            font-weight: 500;
        }
        
        .score {
            font-weight: bold;
            font-size: 18px;
        }
        
        .trump-info {
            text-align: center;
            font-style: italic;
            color: #666;
            margin-bottom: 10px;
        }
        
        .data-issues {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .data-issues h3 {
            color: #856404;
            margin-top: 0;
        }
        
        .issue-item {
            margin: 8px 0;
            padding: 8px;
            background: #fef9e7;
            border-left: 3px solid #f39c12;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c5234;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 6px;
            padding: 20px;
            color: #c62828;
            text-align: center;
        }
        
        .filter-controls {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #333;
        }
        
        .filter-group select, .filter-group input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Raw Tournament Data Debug</h1>
        <p>This page shows all imported tournament data for verification against the original Google Sheets.</p>
        
        <div id="loading" class="loading">
            <h2>Loading tournament data...</h2>
            <p>Please wait while we fetch and process all tournament data from Google Sheets.</p>
        </div>
        
        <div id="error" class="error hidden">
            <h2>Error Loading Data</h2>
            <p id="error-message"></p>
        </div>
        
        <div id="content" class="hidden">
            <!-- Summary Statistics -->
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-tournaments">0</div>
                    <div class="stat-label">Tournaments</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-scorecards">0</div>
                    <div class="stat-label">Scorecards</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-rounds">0</div>
                    <div class="stat-label">Total Rounds</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-players">0</div>
                    <div class="stat-label">Unique Players</div>
                </div>
            </div>
            
            <!-- Data Issues -->
            <div id="data-issues" class="data-issues hidden">
                <h3>‚ö†Ô∏è Data Issues Found</h3>
                <div id="issues-list"></div>
            </div>
            
            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="tournament-filter">Tournament:</label>
                        <select id="tournament-filter">
                            <option value="">All Tournaments</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="round-filter">Round:</label>
                        <select id="round-filter">
                            <option value="">All Rounds</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="table-filter">Table:</label>
                        <select id="table-filter">
                            <option value="">All Tables</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="player-filter">Player:</label>
                        <input type="text" id="player-filter" placeholder="Search player name...">
                    </div>
                </div>
            </div>
            
            <!-- Tournament Data -->
            <div id="tournament-data"></div>
        </div>
    </div>

    <script src="assets/js/tournament-engine.js"></script>
    <script>
        let tournamentEngine;
        let allScorecards = [];
        let filteredScorecards = [];
        
        // Initialize the debug page
        async function initDebugPage() {
            try {
                console.log('üîç Initializing debug page...');
                
                // Create tournament engine and load data
                tournamentEngine = new TournamentEngine();
                await tournamentEngine.loadFromGoogleSheets('1HGfdlDOfGHOL6Q4MP_TnF8UNE6YihBW-5gQs6Ykl78k');
                
                // Get all raw scorecards
                allScorecards = tournamentEngine.rawScorecards || [];
                filteredScorecards = [...allScorecards];
                
                console.log(`üìä Loaded ${allScorecards.length} scorecards`);
                
                // Hide loading, show content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                
                // Populate summary statistics
                populateSummaryStats();
                
                // Show data issues if any
                showDataIssues();
                
                // Populate filter controls
                populateFilters();
                
                // Display tournament data
                displayTournamentData();
                
                console.log('‚úÖ Debug page initialized successfully');
                
            } catch (error) {
                console.error('‚ùå Error initializing debug page:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
            }
        }
        
        // Populate summary statistics
        function populateSummaryStats() {
            const tournaments = [...new Set(allScorecards.map(s => s.Tournament))];
            const rounds = [...new Set(allScorecards.map(s => s.Round))];
            const players = new Set();
            
            allScorecards.forEach(scorecard => {
                if (scorecard.Player1Names) {
                    scorecard.Player1Names.names.forEach(name => players.add(name));
                }
                if (scorecard.Player2Names) {
                    scorecard.Player2Names.names.forEach(name => players.add(name));
                }
                if (scorecard.Opponent1Names) {
                    scorecard.Opponent1Names.names.forEach(name => players.add(name));
                }
                if (scorecard.Opponent2Names) {
                    scorecard.Opponent2Names.names.forEach(name => players.add(name));
                }
            });
            
            document.getElementById('total-tournaments').textContent = tournaments.length;
            document.getElementById('total-scorecards').textContent = allScorecards.length;
            document.getElementById('total-rounds').textContent = rounds.length;
            document.getElementById('total-players').textContent = players.size;
        }
        
        // Show data issues
        function showDataIssues() {
            const issues = tournamentEngine.getDataIssues();
            if (issues.length > 0) {
                document.getElementById('data-issues').classList.remove('hidden');
                
                const issuesList = document.getElementById('issues-list');
                issuesList.innerHTML = issues.map(issue => `
                    <div class="issue-item">
                        <strong>${issue.type.toUpperCase()}:</strong> ${issue.message}
                        ${issue.sheet ? ` (${issue.sheet})` : ''}
                    </div>
                `).join('');
            }
        }
        
        // Populate filter controls
        function populateFilters() {
            const tournaments = [...new Set(allScorecards.map(s => s.Tournament))];
            const rounds = [...new Set(allScorecards.map(s => parseInt(s.Round)))].sort((a, b) => a - b);
            const tables = [...new Set(allScorecards.map(s => parseInt(s.Table)))].sort((a, b) => a - b);
            
            // Populate tournament filter
            const tournamentFilter = document.getElementById('tournament-filter');
            tournaments.forEach(tournament => {
                const option = document.createElement('option');
                option.value = tournament;
                option.textContent = tournament;
                tournamentFilter.appendChild(option);
            });
            
            // Populate round filter
            const roundFilter = document.getElementById('round-filter');
            rounds.forEach(round => {
                const option = document.createElement('option');
                option.value = round;
                option.textContent = `Round ${round}`;
                roundFilter.appendChild(option);
            });
            
            // Populate table filter
            const tableFilter = document.getElementById('table-filter');
            tables.forEach(table => {
                const option = document.createElement('option');
                option.value = table;
                option.textContent = `Table ${table}`;
                tableFilter.appendChild(option);
            });
            
            // Add event listeners
            tournamentFilter.addEventListener('change', applyFilters);
            roundFilter.addEventListener('change', applyFilters);
            tableFilter.addEventListener('change', applyFilters);
            document.getElementById('player-filter').addEventListener('input', applyFilters);
        }
        
        // Apply filters
        function applyFilters() {
            const tournamentFilter = document.getElementById('tournament-filter').value;
            const roundFilter = document.getElementById('round-filter').value;
            const tableFilter = document.getElementById('table-filter').value;
            const playerFilter = document.getElementById('player-filter').value.toLowerCase();
            
            filteredScorecards = allScorecards.filter(scorecard => {
                // Tournament filter
                if (tournamentFilter && scorecard.Tournament !== tournamentFilter) {
                    return false;
                }
                
                // Round filter
                if (roundFilter && scorecard.Round !== roundFilter) {
                    return false;
                }
                
                // Table filter
                if (tableFilter && scorecard.Table !== tableFilter) {
                    return false;
                }
                
                // Player filter
                if (playerFilter) {
                    const playerNames = [
                        ...(scorecard.Player1Names?.names || []),
                        ...(scorecard.Player2Names?.names || []),
                        ...(scorecard.Opponent1Names?.names || []),
                        ...(scorecard.Opponent2Names?.names || [])
                    ].map(name => name.toLowerCase());
                    
                    if (!playerNames.some(name => name.includes(playerFilter))) {
                        return false;
                    }
                }
                
                return true;
            });
            
            displayTournamentData();
        }
        
        // Display tournament data
        function displayTournamentData() {
            const tournamentData = document.getElementById('tournament-data');
            
            if (filteredScorecards.length === 0) {
                tournamentData.innerHTML = '<p>No data matches the current filters.</p>';
                return;
            }
            
            // Group scorecards by tournament, round, and table
            const grouped = {};
            
            filteredScorecards.forEach(scorecard => {
                const tournament = scorecard.Tournament;
                const round = parseInt(scorecard.Round);
                const table = parseInt(scorecard.Table);
                
                if (!grouped[tournament]) {
                    grouped[tournament] = {};
                }
                if (!grouped[tournament][round]) {
                    grouped[tournament][round] = {};
                }
                if (!grouped[tournament][round][table]) {
                    grouped[tournament][round][table] = [];
                }
                
                grouped[tournament][round][table].push(scorecard);
            });
            
            // Generate HTML
            let html = '';
            
            Object.keys(grouped).sort().forEach(tournament => {
                html += `
                    <div class="tournament-section">
                        <div class="tournament-header">
                            <h2>${tournament}</h2>
                        </div>
                `;
                
                Object.keys(grouped[tournament]).sort((a, b) => parseInt(a) - parseInt(b)).forEach(round => {
                    html += `
                        <div class="round-section">
                            <div class="round-header">
                                Round ${round}
                            </div>
                            <div class="table-grid">
                    `;
                    
                    Object.keys(grouped[tournament][round]).sort((a, b) => parseInt(a) - parseInt(b)).forEach(table => {
                        const scorecards = grouped[tournament][round][table];
                        const trumpSuit = scorecards[0]?.Trump_Suit || 'Unknown';
                        
                        html += `
                            <div class="table-card">
                                <div class="table-header">Table ${table}</div>
                                <div class="trump-info">Trump: ${trumpSuit}</div>
                        `;
                        
                        scorecards.forEach(scorecard => {
                            const player1Names = scorecard.Player1Names?.names || [scorecard.Player1 || 'Unknown'];
                            const player2Names = scorecard.Player2Names?.names || [scorecard.Player2 || 'Unknown'];
                            const opponent1Names = scorecard.Opponent1Names?.names || [scorecard.Opponent1 || 'Unknown'];
                            const opponent2Names = scorecard.Opponent2Names?.names || [scorecard.Opponent2 || 'Unknown'];
                            
                            const tricksWon = parseInt(scorecard.Tricks_Won);
                            const opponentTricks = parseInt(scorecard.Opponent_Tricks);
                            
                            const partnership1 = `${player1Names.join(' & ')} + ${player2Names.join(' & ')}`;
                            const partnership2 = `${opponent1Names.join(' & ')} + ${opponent2Names.join(' & ')}`;
                            
                            const partnership1Winner = tricksWon > opponentTricks;
                            const partnership2Winner = opponentTricks > tricksWon;
                            
                            html += `
                                <div class="partnership ${partnership1Winner ? 'winner' : 'loser'}">
                                    <span class="players">${partnership1}</span>
                                    <span class="score">${tricksWon}</span>
                                </div>
                                <div class="partnership ${partnership2Winner ? 'winner' : 'loser'}">
                                    <span class="players">${partnership2}</span>
                                    <span class="score">${opponentTricks}</span>
                                </div>
                            `;
                            
                            if (scorecard.hasDataIssue) {
                                html += `<div style="color: #f39c12; font-size: 12px; margin-top: 5px;">‚ö†Ô∏è ${scorecard.dataIssue}</div>`;
                            }
                        });
                        
                        html += `
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    </div>
                `;
            });
            
            tournamentData.innerHTML = html;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDebugPage);
    </script>
</body>
</html> 