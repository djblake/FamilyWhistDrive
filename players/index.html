<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Directory | Ruston Family Whist Drive</title>
    <meta name="description" content="Complete directory of all players from 40 years of championship Whist tournaments">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="card-suits"><span class="heart">‚ô•</span> <span class="club">‚ô£</span> <span class="diamond">‚ô¶</span> <span class="spade">‚ô†</span></div>
                    <h1 class="site-title">Ruston Family Whist Drive</h1>
                    <p class="site-subtitle">Est. 1984 ‚Ä¢ The World's Most Elite Family Tournament</p>
                </div>
                <nav class="main-nav">
                    <a href="../" class="nav-link">Home</a>
                    <a href="../tournaments/" class="nav-link">Tournaments</a>
                    <a href="../tables/" class="nav-link">Tables</a>
                    <a href="#" class="nav-link active">Players</a>
                    <a href="../leaderboard/" class="nav-link">Hall of Fame</a>
                    <a href="../stats/" class="nav-link">Statistics</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section class="players-hero">
            <div class="container">
                <div class="hero-content">
                    <div class="players-badge">üë• PLAYER DIRECTORY</div>
                    <h1 class="hero-title">All Tournament Players</h1>
                    <p class="hero-subtitle">Complete directory of everyone who has competed in 40 years of family tournament history</p>
                    
                    <div class="search-controls">
                        <input type="text" id="player-search" placeholder="Search players by name..." class="search-input">
                        <div class="filter-controls">
                            <select id="tournament-filter" class="filter-select">
                                <option value="">All Years</option>
                            </select>
                            <select id="championship-filter" class="filter-select">
                                <option value="">All Players</option>
                                <option value="champions">Champions Only</option>
                                <option value="podium">Top 3 Finishers</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="players-table-section">
            <div class="container">
                <div class="table-header">
                    <h2 class="section-title">
                        <span class="title-icon">üë•</span>
                        The Players
                    </h2>
                    <div class="table-stats" id="table-stats">
                        <span class="stat-item">Total Players: <strong id="total-players">-</strong></span>
                        <span class="stat-item">Champions: <strong id="total-champions">-</strong></span>
                        <span class="stat-item">Active Years: <strong id="year-range">-</strong></span>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="players-table" id="players-table">
                        <thead>
                            <tr>
                                <th>
                                    <span class="header-content">
                                        <span class="header-text">Rank</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="name">
                                    <span class="header-content">
                                        <span class="header-text">Player</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="championships">
                                    <span class="header-content">
                                        <span class="header-text">Wins üèÜ</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="top_three">
                                    <span class="header-content">
                                        <span class="header-text">Placed Top 3</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="total_tricks">
                                    <span class="header-content">
                                        <span class="header-text">Career Tricks</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="tournaments_played">
                                    <span class="header-content">
                                        <span class="header-text">Tournaments</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="avg_tricks">
                                    <span class="header-content">
                                        <span class="header-text">Avg Tricks</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="sortable" data-column="first_year">
                                    <span class="header-content">
                                        <span class="header-text">First Year</span>
                                        <span class="sort-arrow">‚ÜïÔ∏è</span>
                                    </span>
                                </th>
                                <th class="profile-header">Profile</th>
                            </tr>
                        </thead>
                        <tbody id="players-tbody">
                            <!-- Players will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-footer">
                    <div class="pagination" id="pagination">
                        <!-- Pagination will be added if needed -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Player Stats</h4>
                    <p><a href="../leaderboard/">Hall of Fame</a></p>
                    <p><a href="../stats/">Advanced Analytics</a></p>
                    <p>Career Records</p>
                </div>
                <div class="footer-section">
                    <h4>Tournaments</h4>
                    <p><a href="../tournaments/">Tournament Archive</a></p>
                    <p>Championship History</p>
                    <p>Player Achievements</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <p><a href="../families/">Family Tree</a></p>
                    <p>Player Profiles</p>
                    <p>Tournament Results</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Ruston Family Whist Drive. Complete player directory since 1984.</p>
            </div>
        </div>
    </footer>

            <script src="../assets/js/tournament-engine.js?v=cache1"></script>
    
    <script>
        let allPlayers = [];
        let currentSort = { column: 'rank', direction: 'asc' };
        let tournamentEngine;

        // Load and display all player data
        document.addEventListener('DOMContentLoaded', async function() {
            tournamentEngine = new TournamentEngine();
            const sheetId = '1HGfdlDOfGHOL6Q4MP_TnF8UNE6YihBW-5gQs6Ykl78k';
            
            try {
                console.log('üë• Loading complete player directory...');
                await tournamentEngine.loadFromGoogleSheets(sheetId);
                
                allPlayers = tournamentEngine.getAllIndividualPlayers('total_tricks');
                
                const tournaments = Array.from(tournamentEngine.tournaments.values());
                
                // Find the most recent tournament and its winner
                const mostRecentTournament = tournaments.length > 0 ? 
                    tournaments.reduce((latest, current) => 
                        current.year > latest.year ? current : latest
                    ) : null;
                const currentChampion = mostRecentTournament ? mostRecentTournament.winner : null;
                
                // Use pre-calculated stats from TournamentEngine and add additional data
                allPlayers.forEach(player => {
                    // Find first tournament year (include shared-hand partnerships)
                    const playerTournaments = tournaments.filter(t => {
                        const appearsIndividually = t.final_standings.some(s => s.player === player.name);
                        const appearsInShared = t.final_standings.some(s => 
                            s.is_partnership && s.partnership_players && s.partnership_players.some(p => p === player.name)
                        );
                        return appearsIndividually || appearsInShared;
                    });
                    const firstYear = playerTournaments.length > 0 ? 
                        Math.min(...playerTournaments.map(t => t.year)) : '-';
                    
                    // Use pre-calculated data from TournamentEngine
                    player.championships = player.tournament_wins; // Map to expected field name
                    player.top_three = player.top_three_finishes; // Use pre-calculated value
                    player.avg_tricks = parseFloat(player.average_tricks).toFixed(2); // Format to 2 decimal places
                    player.first_year = firstYear;
                    player.isCurrentChampion = player.name === currentChampion;
                });

                // Default sorting: championships -> top three finishes -> average tricks
                allPlayers.sort((a, b) => {
                    if (b.championships !== a.championships) {
                        return b.championships - a.championships;
                    }
                    if (b.top_three !== a.top_three) {
                        return b.top_three - a.top_three;
                    }
                    return parseFloat(b.avg_tricks) - parseFloat(a.avg_tricks);
                });

                // Assign rank after initial sort
                allPlayers.forEach((player, index) => {
                    player.rank = index + 1;
                });
                
                // Populate year filter
                const years = [...new Set(tournaments.map(t => t.year))].sort((a, b) => b - a);
                const yearFilter = document.getElementById('tournament-filter');
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearFilter.appendChild(option);
                });
                
                // Update summary stats
                updateSummaryStats();
                
                // Display all players
                displayPlayers(allPlayers);
                
                // Set up event listeners
                setupEventListeners();
                
                console.log('‚úÖ Complete player directory loaded successfully!');
                
            } catch (error) {
                console.error('‚ùå Error loading player data:', error);
                document.getElementById('players-tbody').innerHTML = 
                    '<tr><td colspan="9" style="text-align: center; color: #666; padding: 2rem;">Error loading player data. Please try refreshing the page.</td></tr>';
            }
        });
        
        function displayPlayers(players) {
            const tbody = document.getElementById('players-tbody');
            
            const playersHTML = players.map(player => {
                const currentChampionIcon = player.isCurrentChampion ? ' üëë' : '';
                const initials = player.name.split(' ').map(n => n[0]).join('');
                const careerTricks = Math.floor(parseFloat(player.total_tricks) || 0).toLocaleString();
                const profileHref = `profile.html?player=${encodeURIComponent(player.name)}`;
                
                return `
                    <tr class="player-row ${player.championships > 0 ? 'champion' : ''}">
                        <td class="rank-cell">
                            <span class="rank-number">${player.rank}</span>
                        </td>
                        <td class="player-cell">
                            <div class="player-info">
                                <div class="player-avatar">
                                    <span class="avatar-initials">${initials}</span>
                                </div>
                                <div class="player-details">
                                    <a class="player-name player-name-link" href="${profileHref}">
                                        ${player.name}${currentChampionIcon}
                                    </a>
                                    ${player.championships > 0 ? 
                                        `<div class="player-title">${player.championships}x Champion</div>` : 
                                        `<div class="player-title">Tournament Player</div>`
                                    }
                                </div>
                            </div>
                        </td>
                        <td class="championships-cell">
                            <span class="championships-count">${player.championships}</span>
                        </td>
                        <td class="top-three-cell">
                            <span class="top-three-count">${player.top_three}</span>
                        </td>
                        <td class="tricks-cell">
                            <span class="tricks-count">${careerTricks}</span>
                        </td>
                        <td class="tournaments-cell">
                            <span class="tournaments-count">${player.tournaments_played}</span>
                        </td>
                        <td class="avg-tricks-cell">
                            <span class="avg-tricks-count">${player.avg_tricks}</span>
                        </td>
                        <td class="year-cell">
                            <span class="year-number">${player.first_year}</span>
                        </td>
                        <td class="profile-cell">
                            <a href="${profileHref}" class="profile-link">
                                View Profile
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = playersHTML;
        }
        
        function updateSummaryStats() {
            const totalPlayers = allPlayers.length;
            const champions = allPlayers.filter(p => p.championships > 0).length;
            const years = allPlayers.filter(p => p.first_year !== '-').map(p => p.first_year);
            const yearRange = years.length > 0 ? 
                `${Math.min(...years)} - ${Math.max(...years)}` : '-';
            
            document.getElementById('total-players').textContent = totalPlayers;
            document.getElementById('total-champions').textContent = champions;
            document.getElementById('year-range').textContent = yearRange;
        }
        
        function setupEventListeners() {
            // Search functionality
            document.getElementById('player-search').addEventListener('input', function(e) {
                filterPlayers();
            });
            
            // Filter functionality
            document.getElementById('tournament-filter').addEventListener('change', filterPlayers);
            document.getElementById('championship-filter').addEventListener('change', filterPlayers);
            
            // Sort functionality
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', function() {
                    const column = this.dataset.column;
                    sortPlayers(column);
                });
            });
        }
        
        function filterPlayers() {
            const searchTerm = document.getElementById('player-search').value.toLowerCase();
            const yearFilter = document.getElementById('tournament-filter').value;
            const championshipFilter = document.getElementById('championship-filter').value;
            
            let filteredPlayers = allPlayers.filter(player => {
                // Name search
                if (searchTerm && !player.name.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // Year filter
                if (yearFilter && player.first_year !== parseInt(yearFilter)) {
                    return false;
                }
                
                // Championship filter
                if (championshipFilter === 'champions' && player.championships === 0) {
                    return false;
                }
                
                if (championshipFilter === 'podium') {
                    // Check if player has top 3 finishes
                    const tournaments = Array.from(tournamentEngine.tournaments.values());
                    const hasTopThree = tournaments.some(t => {
                        const playerStanding = t.final_standings.find(s => s.player === player.name);
                        return playerStanding && playerStanding.rank <= 3;
                    });
                    if (!hasTopThree) return false;
                }
                
                return true;
            });
            
            displayPlayers(filteredPlayers);
        }
        
        function sortPlayers(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            
            // Clear previous sort indicators
            document.querySelectorAll('.sort-arrow').forEach(arrow => {
                arrow.textContent = '‚ÜïÔ∏è';
            });
            
            // Set current sort indicator
            const currentHeader = document.querySelector(`[data-column="${column}"] .sort-arrow`);
            currentHeader.textContent = currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
            
            allPlayers.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                // Handle special cases
                if (column === 'name') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                } else if (column === 'rank' || column === 'championships' || column === 'top_three' || 
                          column === 'total_tricks' || column === 'tournaments_played' || 
                          column === 'avg_tricks' || column === 'first_year') {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                }
                
                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            // Re-assign ranks after sorting
            allPlayers.forEach((player, index) => {
                player.rank = index + 1;
            });
            
            filterPlayers(); // Reapply current filters
        }
    </script>
    
    <style>
        /* Players Directory Specific Styles */
        .players-hero {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--primary-dark) 100%);
            color: var(--text-primary);
            padding: var(--spacing-3xl) 0;
            position: relative;
            overflow: hidden;
        }

        .players-hero::before {
            content: 'üë•';
            position: absolute;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            font-size: 15rem;
            opacity: 0.1;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .players-badge {
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold);
            padding: var(--spacing-sm) var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            margin-bottom: var(--spacing-lg);
            display: inline-block;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-primary);
        }

        .hero-subtitle {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: var(--spacing-xl);
        }

        .search-controls {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-md);
            font-size: 1rem;
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            backdrop-filter: blur(10px);
        }

        .search-input::placeholder {
            color: rgba(248, 250, 252, 0.6);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        .filter-controls {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        .filter-select {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            backdrop-filter: blur(10px);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .players-table-section {
            padding: var(--spacing-3xl) 0;
            background: var(--bg-secondary);
        }

        .table-header {
            margin-bottom: var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .table-stats {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .stat-item {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .stat-item strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .table-container {
            background: white;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-card);
        }

        .players-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .players-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
            color: var(--text-primary-dark);
            border-bottom: 2px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }

        .sortable:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sort-arrow {
            opacity: 0.5;
            font-size: 0.75rem;
        }

        .players-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid #f1f3f5;
            vertical-align: middle;
        }

        .player-row:hover {
            background-color: #f8f9fa;
        }

        .player-row.champion {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.05) 0%, transparent 100%);
        }

        .rank-cell {
            font-weight: 600;
            color: var(--text-primary-dark);
            text-align: center;
            min-width: 60px;
        }

        .rank-number {
            font-size: 1rem;
        }

        .player-cell {
            min-width: 200px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .avatar-initials {
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
        }

        .player-details {
            min-width: 0;
        }

        .player-name {
            font-weight: 600;
            color: var(--text-primary-dark);
            margin-bottom: 2px;
        }

        .player-name-link {
            display: inline-block;
            text-decoration: none;
            color: var(--text-primary-dark);
        }

        .player-name-link:hover {
            text-decoration: underline;
        }

        .player-title {
            font-size: 0.75rem;
            color: var(--text-secondary-dark);
        }

        .championships-cell {
            text-align: center;
            font-weight: 600;
        }

        .championships-count {
            color: var(--gold);
            font-size: 1.1rem;
        }

        .top-three-cell {
            text-align: center;
            font-weight: 600;
        }

        .top-three-count {
            color: var(--primary);
            font-size: 1rem;
        }

        .tricks-cell,
        .tournaments-cell,
        .avg-tricks-cell,
        .year-cell {
            text-align: center;
            font-weight: 500;
        }

        .tricks-count,
        .tournaments-count,
        .avg-tricks-count,
        .year-number {
            color: var(--text-primary-dark);
            font-size: 1rem;
        }

        .tricks-cell, .tournaments-cell, .avg-tricks-cell {
            text-align: center;
            font-weight: 500;
        }

        .year-cell {
            text-align: center;
            font-weight: 500;
            color: var(--text-secondary-dark);
        }

        .profile-header {
            min-width: 120px;
            width: 120px;
        }

        .profile-cell {
            text-align: center;
            min-width: 120px;
            width: 120px;
        }

        .profile-link {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #2563eb 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
            border: none;
            min-width: 90px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .profile-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .profile-link:hover {
            background: linear-gradient(135deg, #5b21b6 0%, #4f46e5 50%, #1d4ed8 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);
        }

        .profile-link:hover::before {
            left: 100%;
        }

        .table-footer {
            margin-top: var(--spacing-lg);
            text-align: center;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }

            .search-controls {
                padding: 0 var(--spacing-md);
            }

            .filter-controls {
                flex-direction: column;
            }

            .table-header {
                flex-direction: column;
                text-align: center;
            }

            .table-stats {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .players-table {
                font-size: 0.75rem;
            }

            .players-table th,
            .players-table td {
                padding: var(--spacing-sm);
            }

            .player-info {
                gap: var(--spacing-sm);
            }

            .player-avatar {
                width: 32px;
                height: 32px;
            }

            .avatar-initials {
                font-size: 0.75rem;
            }

            /* Hide some columns on mobile */
            .players-table th:nth-child(6),
            .players-table td:nth-child(6),
            .players-table th:nth-child(7),
            .players-table td:nth-child(7) {
                display: none;
            }
        }
    </style>
</body>
</html>