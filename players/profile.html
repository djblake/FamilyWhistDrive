<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Profile | Ruston Family Whist Drive</title>
    <meta name="description" content="Complete career statistics and achievements for a championship Whist player">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="card-suits"><span class="heart">‚ô•</span> <span class="club">‚ô£</span> <span class="diamond">‚ô¶</span> <span class="spade">‚ô†</span></div>
                    <h1 class="site-title">Ruston Family Whist Drive</h1>
                    <p class="site-subtitle">Est. 1984 ‚Ä¢ The World's Most Elite Family Tournament</p>
                </div>
                <nav class="main-nav">
                    <a href="../" class="nav-link">Home</a>
                    <a href="../tournaments/" class="nav-link">Tournaments</a>
                    <a href="./" class="nav-link active">Players</a>
                    <a href="../leaderboard/" class="nav-link">Hall of Fame</a>
                    <a href="../stats/" class="nav-link">Statistics</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section class="player-hero">
            <div class="container">
                <div class="player-profile">
                    <div class="player-avatar">
                        <div class="avatar-placeholder">
                            <div class="avatar-icon" id="player-icon">üéØ</div>
                            <div class="avatar-initial" id="player-initial">--</div>
                        </div>
                        <div class="champion-badge" id="champion-badge" style="display: none;">Champion</div>
                    </div>
                    
                    <div class="player-info">
                        <div class="player-header">
                            <h1 class="player-name" id="player-name">Loading...</h1>
                            <div class="player-nickname" id="player-nickname" style="display: none;"></div>
                            <div class="player-title" id="player-title">Tournament Player</div>
                        </div>
                        
                        <div class="player-meta" id="player-meta">
                            <div class="meta-item">
                                <span class="meta-label">First Tournament</span>
                                <span class="meta-value" id="first-tournament">-</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Years Active</span>
                                <span class="meta-value" id="years-active">-</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Total Tournaments</span>
                                <span class="meta-value" id="total-tournaments">-</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Current Ranking</span>
                                <span class="meta-value" id="current-ranking">-</span>
                            </div>
                        </div>

                        <div class="family-tree-link">
                            <a href="../families/" class="family-tree-btn">
                                <span class="tree-icon">üå≥</span>
                                View in Family Tree
                            </a>
                        </div>

                        <div class="career-highlights" id="career-highlights">
                            <div class="highlight-card primary">
                                <div class="highlight-icon">üèÜ</div>
                                <div class="highlight-content">
                                    <div class="highlight-number" id="tournament-victories">-</div>
                                    <div class="highlight-label">Tournament Victories</div>
                                </div>
                            </div>
                            <div class="highlight-card">
                                <div class="highlight-icon">üéØ</div>
                                <div class="highlight-content">
                                    <div class="highlight-number" id="total-tricks">-</div>
                                    <div class="highlight-label">Total Tricks</div>
                                </div>
                            </div>
                            <div class="highlight-card">
                                <div class="highlight-icon">üìä</div>
                                <div class="highlight-content">
                                    <div class="highlight-number" id="avg-tricks">-</div>
                                    <div class="highlight-label">Avg Tricks/Round</div>
                                </div>
                            </div>
                            <div class="highlight-card">
                                <div class="highlight-icon">ü•â</div>
                                <div class="highlight-content">
                                    <div class="highlight-number" id="top-finishes">-</div>
                                    <div class="highlight-label">Top 3 Finishes</div>
                                </div>
                            </div>
                        </div>

                        <div class="trophy-cabinet" id="trophy-cabinet">
                            <div class="trophy-cabinet-label">Trophy Cabinet</div>
                            <div class="trophy-cabinet-content" id="trophy-cabinet-content">
                                <div class="loading-message">Loading trophy cabinet...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="player-stats">
            <div class="container">
                <div class="stats-grid">
                    <div class="stats-section">
                        <h3 class="section-title">
                            <span class="title-icon">üìà</span>
                            Career Statistics
                        </h3>
                        <div class="stats-table" id="career-stats">
                            <div class="loading-message">Loading career statistics...</div>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3 class="section-title">
                            <span class="title-icon">üìä</span>
                            Performance
                        </h3>
                        <div class="stats-table" id="performance-stats">
                            <div class="loading-message">Loading performance metrics...</div>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3 class="section-title">
                            <span class="title-icon">üÉè</span>
                            Trump Suit Performance
                        </h3>
                        <div class="trump-stats-grid" id="trump-stats">
                            <div class="loading-message">Loading trump suit statistics...</div>
                        </div>
                    </div>

                    <div class="stats-section full-width">
                        <h3 class="section-title">
                            <span class="title-icon">üìâ</span>
                            Seed Rank History
                        </h3>
                        <div class="chart-container" id="seed-rank-chart">
                            <div class="loading-message">Loading seed rank history...</div>
                        </div>
                    </div>

                    <div class="stats-section full-width">
                        <h3 class="section-title">
                            <span class="title-icon">üèÜ</span>
                            Tournament History
                        </h3>
                        <div class="tournament-timeline" id="tournament-timeline">
                            <div class="loading-message">Loading tournament history...</div>
                        </div>
                        <div class="timeline-controls">
                            <div class="timeline-meta" id="tournament-timeline-meta"></div>
                            <button type="button" class="timeline-toggle-btn" id="toggle-tournament-history" style="display:none;"></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Featured Players</h4>
                    <p><a href="./">All Players</a></p>
                </div>
                <div class="footer-section">
                    <h4>Player Stats</h4>
                    <p><a href="../leaderboard/">Rankings</a></p>
                    <p><a href="../stats/">Advanced Analytics</a></p>
                </div>
                <div class="footer-section">
                    <h4>Tournaments</h4>
                    <p><a href="../tournaments/">Tournament Archive</a></p>
                    <p><a href="../tournaments/scorecard.html">Scorecards</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Ruston Family Whist Drive. Player profiles and statistics.</p>
            </div>
        </div>
    </footer>

    <style>
        .trump-stats-list {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 2px solid var(--border-light);
            margin-top: var(--spacing-lg);
        }

        .trump-title {
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
            color: #2d3748;
            margin-bottom: var(--spacing-md);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .trump-suit-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) 0;
        }

        .trump-suit-icon {
            font-size: 1.5rem;
            min-width: 1.5rem;
        }

        .trump-suit-name {
            font-weight: 600;
            color: #2d3748;
            flex: 1;
            margin-left: var(--spacing-sm);
        }

        .trump-average {
            font-weight: 700;
            color: #2d3748;
            text-align: center;
            min-width: 50px;
        }

        .trump-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, var(--border-light) 20%, var(--border-light) 80%, transparent 100%);
            margin: 0 var(--spacing-sm);
        }

        .heart { color: #e53e3e; }
        .diamond { color: #e53e3e; }
        .club { color: #1a202c; }
        .spade { color: #1a202c; }

        @media (max-width: 768px) {
            .trump-stats-list {
                padding: var(--spacing-md);
            }
            
            .trump-title {
                font-size: 0.9rem;
                margin-bottom: var(--spacing-sm);
            }
            
            .trump-suit-row {
                padding: var(--spacing-sm) 0;
            }
            
            .trump-suit-icon {
                font-size: 1.25rem;
                min-width: 1.25rem;
            }
            
            .trump-suit-name {
                font-size: 0.9rem;
            }
            
            .trump-average {
                font-size: 0.9rem;
                min-width: 45px;
            }
        }
    </style>

            <script src="../assets/js/tournament-engine.js?v=cache1"></script>
    <script src="../assets/js/charts.js?v=24"></script>
    
    <script>
        // Get player name from URL parameter
        function getPlayerFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('player');
        }

        // Load player profile data
        document.addEventListener('DOMContentLoaded', async function() {
            const playerName = getPlayerFromURL();
            
            if (!playerName) {
                // Redirect to players index if no player specified
                window.location.href = './';
                return;
            }

            console.log(`üë§ Loading profile for: ${playerName}`);

            const tournamentEngine = new TournamentEngine();
            window.tournamentEngine = tournamentEngine; // Make it globally accessible
            const sheetId = '1HGfdlDOfGHOL6Q4MP_TnF8UNE6YihBW-5gQs6Ykl78k';
            
            try {
                await tournamentEngine.loadFromGoogleSheets(sheetId);
                
                const players = tournamentEngine.getAllPlayers('total_tricks');
                const tournaments = Array.from(tournamentEngine.tournaments.values());

                // Precompute global min/max avg tricks per round (for barometer scaling)
                window.__globalAvgTricksRange = computeGlobalAvgTricksRange(tournamentEngine, tournaments);
                
                // Find the player
                const player = players.find(p => p.name.toLowerCase() === playerName.toLowerCase());
                
                if (!player) {
                    console.error(`‚ùå Player "${playerName}" not found`);
                    document.getElementById('player-name').textContent = 'Player Not Found';
                    document.getElementById('player-title').textContent = 'This player could not be found in our records.';
                    return;
                }

                // Get full name for profile display
                const fullName = tournamentEngine.getPlayerFullName(player.name);
                
                // Update page title and meta
                document.title = `${fullName} - Player Profile | Ruston Family Whist Drive`;
                
                // Update player information - use full name for profile display
                document.getElementById('player-name').textContent = fullName;
                document.getElementById('player-initial').textContent = player.name.split(' ').map(n => n[0]).join('');
                
                // Get player statistics - include tournaments where player appears individually OR in shared hands
                const playerTournaments = tournaments.filter(t => {
                    // Check if player appears individually in final standings
                    const appearsIndividually = t.final_standings.some(s => s.player === player.name);
                    
                    // Check if player appears in any shared hand partnerships
                    const appearsInSharedHands = t.final_standings.some(s => 
                        s.is_partnership && 
                        s.partnership_players && 
                        s.partnership_players.some(p => p === player.name)
                    );
                    
                    return appearsIndividually || appearsInSharedHands;
                });
                
                const championships = tournaments.filter(t => t.winner === player.name).length;
                const topThreeFinishes = tournaments.filter(t => {
                    // Check individual ranking first
                    const individualRanking = t.final_standings.findIndex(s => s.player === player.name) + 1;
                    if (individualRanking <= 3 && individualRanking > 0) {
                        return true;
                    }
                    
                    // Check if player was in a shared hand partnership that finished in top 3
                    const sharedHandRanking = t.final_standings.findIndex(s => 
                        s.is_partnership && 
                        s.partnership_players && 
                        s.partnership_players.some(p => p === player.name)
                    ) + 1;
                    
                    return sharedHandRanking <= 3 && sharedHandRanking > 0;
                }).length;
                
                const firstYear = Math.min(...playerTournaments.map(t => t.year));
                const lastYear = Math.max(...playerTournaments.map(t => t.year));
                const yearsActive = lastYear - firstYear + 1;
                
                const avgTricks = player.total_rounds > 0 ? 
                    (player.total_tricks / player.total_rounds).toFixed(2) : '0.00';
                
                // Update champion status
                if (championships > 0) {
                    document.getElementById('champion-badge').style.display = 'block';
                    document.getElementById('champion-badge').textContent = 
                        championships === 1 ? 'Champion' : `${championships}x Champion`;
                    document.getElementById('player-icon').textContent = 'üëë';
                    document.getElementById('player-title').textContent = 
                        championships === 1 ? 'Tournament Champion' : `${championships}-Time Champion`;
                } else if (topThreeFinishes > 0) {
                    document.getElementById('player-icon').textContent = 'üèÜ';
                    document.getElementById('player-title').textContent = 'Championship Contender';
                } else {
                    document.getElementById('player-icon').textContent = 'üéØ';
                    document.getElementById('player-title').textContent = 'Tournament Player';
                }
                
                // Update meta information
                document.getElementById('first-tournament').textContent = firstYear;
                document.getElementById('years-active').textContent = `${yearsActive} year${yearsActive !== 1 ? 's' : ''}`;
                document.getElementById('total-tournaments').textContent = player.tournaments_played;
                
                // Get current ranking
                const playerRanking = players.findIndex(p => p.name === player.name) + 1;
                document.getElementById('current-ranking').textContent = `#${playerRanking}`;
                
                // Update career highlights
                const performanceStats = tournamentEngine.getPlayerPerformanceStats(player.name) || {};
                
                document.getElementById('tournament-victories').textContent = championships;
                document.getElementById('total-tricks').textContent = player.total_tricks.toLocaleString();
                document.getElementById('avg-tricks').textContent = avgTricks;
                document.getElementById('top-finishes').textContent = topThreeFinishes;
                
                updatePerformanceStats(player.name, performanceStats);
                generateTrophyCabinet(player.name, playerTournaments);
                renderSeedRankHistoryChart(player.name);
                
                // Generate career statistics table
                generateCareerStats(player, playerTournaments);
                
                // Generate tournament timeline
                generateTournamentTimeline(player, playerTournaments);
                
                // Rank progression chart removed as requested
                
                console.log('‚úÖ Player profile loaded successfully!');
                
            } catch (error) {
                console.error('‚ùå Error loading player profile:', error);
                document.getElementById('player-name').textContent = 'Error Loading Player';
                document.getElementById('player-title').textContent = 'There was an error loading this player profile.';
            }
        });

        function generateCareerStats(player, tournaments) {
            // Use centralized calculation methods for caching compatibility
            const engine = window.tournamentEngine;
            
            if (!engine || typeof engine.getPlayerVictoryCount !== 'function') {
                console.error('‚ùå Tournament engine not available or missing methods');
                return;
            }
            
            const victories = engine.getPlayerVictoryCount(player.name);
            const top3Finishes = engine.getPlayerTop3Count(player.name);
            const winRate = engine.getPlayerWinRate(player.name);

            const statsHTML = `
                <div class="stats-row">
                    <div class="stat-label">Tournament Victories</div>
                    <div class="stat-value">${victories}</div>
                </div>
                <div class="stats-row">
                    <div class="stat-label">Top 3 Finishes</div>
                    <div class="stat-value">${top3Finishes}</div>
                </div>
                <div class="stats-row">
                    <div class="stat-label">Total Tournaments</div>
                    <div class="stat-value">${player.tournaments_played}</div>
                </div>
                <div class="stats-row">
                    <div class="stat-label">Total Tricks</div>
                    <div class="stat-value">${player.total_tricks.toLocaleString()}</div>
                </div>
            `;
            
                document.getElementById('career-stats').innerHTML = statsHTML;
            
                // Generate trump suit statistics
                generateTrumpSuitStats(player.name);
        }

        function updatePerformanceStats(playerName, performanceStats) {
            const performanceContainer = document.getElementById('performance-stats');
            if (!performanceContainer) return;
            const engine = window.tournamentEngine;
            
            const seedRank = performanceStats.seed_rank ? `#${performanceStats.seed_rank}` : 'Unranked';
            const seedScore = performanceStats.seed_points ? `${performanceStats.seed_points} pts` : '‚Äî';
            const avgTricks = performanceStats.average_tricks ?? '0.00';
            const topPercentile = typeof performanceStats.top_percentile === 'number' ? `${performanceStats.top_percentile.toFixed(1)}%` : '‚Äî';
            const topThreeRate = `${(performanceStats.top_three_rate ?? 0).toFixed(1)}%`;

            let peakSeedRow = '';
            if (engine && typeof engine.getSeedRankHistory === 'function' && playerName) {
                const history = engine.getSeedRankHistory(playerName, true) || [];
                let bestRank = null;
                let lastYear = null;
                history.forEach(entry => {
                    if (!entry || !entry.seed_rank) return;
                    if (bestRank === null || entry.seed_rank < bestRank) {
                        bestRank = entry.seed_rank;
                        lastYear = entry.year;
                    } else if (entry.seed_rank === bestRank) {
                        lastYear = entry.year;
                    }
                });
                if (bestRank !== null) {
                    peakSeedRow = `
                        <div class="stats-row">
                            <div class="stat-label">Peak Seed Rank</div>
                            <div class="stat-value">#${bestRank} <span class="stat-detail">(last in ${lastYear})</span></div>
                        </div>
                    `;
                }
            }
            
            performanceContainer.innerHTML = `
                <div class="stats-row">
                    <div class="stat-label">Seed Ranking</div>
                    <div class="stat-value">${seedRank} <span class="stat-detail">(${seedScore})</span></div>
                </div>
                ${peakSeedRow}
                <div class="stats-row">
                    <div class="stat-label">Average Tricks/Round</div>
                    <div class="stat-value">${avgTricks}</div>
                </div>
                <div class="stats-row">
                    <div class="stat-label">Top Percentile Finish Position</div>
                    <div class="stat-value">${topPercentile}</div>
                </div>
                <div class="stats-row">
                    <div class="stat-label">Top 3 Win Rate</div>
                    <div class="stat-value">${topThreeRate}</div>
                </div>
            `;
        }

        function renderSeedRankHistoryChart(playerName) {
            const container = document.getElementById('seed-rank-chart');
            const engine = window.tournamentEngine;
            if (!container) return;
            if (!engine || typeof engine.getSeedRankHistory !== 'function') {
                container.innerHTML = '<p class="muted">Seed rank history unavailable.</p>';
                return;
            }

            const history = (engine.getSeedRankHistory(playerName, true) || [])
                .filter(h => h && typeof h.seed_rank === 'number' && Number.isFinite(h.year))
                .slice()
                .sort((a, b) => a.year - b.year);
            if (!history.length) {
                container.innerHTML = '<p class="muted">No seed rank history yet.</p>';
                return;
            }

            const years = history.map(h => h.year);
            const ranks = history.map(h => h.seed_rank);
            const minYear = Math.min(...years);
            const maxYear = Math.max(...years);
            const maxRank = Math.max(...ranks);

            const width = 980;
            const height = 300;
            const padLeft = 46;
            const padRight = 18;
            const padTop = 26;
            const padBottom = 86;

            const xForYear = (y) => {
                if (maxYear === minYear) return padLeft;
                return padLeft + ((y - minYear) / (maxYear - minYear)) * (width - padLeft - padRight);
            };
            const yForRank = (r) => {
                // Lower rank is better: rank 1 at top.
                if (maxRank <= 1) return padTop;
                return padTop + ((r - 1) / (maxRank - 1)) * (height - padTop - padBottom);
            };

            const points = history.map(h => `${xForYear(h.year).toFixed(1)},${yForRank(h.seed_rank).toFixed(1)}`).join(' ');

            const latest = history[history.length - 1];
            const latestLabel = latest ? `Latest: ${latest.year} (#${latest.seed_rank})` : '';

            const uniqueYears = Array.from(new Set(years)).sort((a, b) => a - b);
            const labelStep = Math.max(1, Math.ceil(uniqueYears.length / 18)); // keep labels readable
            const xAxisY = height - padBottom;
            const yAxisX = padLeft;
            const tickLen = 8;
            const yearLabels = uniqueYears
                .filter((_, idx) => idx % labelStep === 0 || idx === uniqueYears.length - 1)
                .map(y => {
                    const x = xForYear(y).toFixed(1);
                    const labelY = (xAxisY + 70).toFixed(1);
                    return `
                        <line x1="${x}" y1="${xAxisY}" x2="${x}" y2="${(xAxisY + tickLen).toFixed(1)}" stroke="rgba(26,26,26,0.25)" />
                        <text transform="translate(${x},${labelY}) rotate(-90)" text-anchor="end" font-size="10" fill="rgba(26,26,26,0.75)">${y}</text>
                    `;
                })
                .join('');

            const pointDots = history.map(h => {
                const x = xForYear(h.year).toFixed(1);
                const y = yForRank(h.seed_rank).toFixed(1);
                const title = `Year ${h.year} ‚Ä¢ Seed #${h.seed_rank}`;
                return `
                    <circle cx="${x}" cy="${y}" r="4.5" fill="rgba(245, 158, 11, 0.95)">
                        <title>${title}</title>
                    </circle>
                `;
            }).join('');

            container.innerHTML = `
                <div class="muted" style="margin-bottom: 0.5rem;">${latestLabel}</div>
                <svg viewBox="0 0 ${width} ${height}" width="100%" height="${height}" role="img" aria-label="Seed rank history">
                    <rect x="0" y="0" width="${width}" height="${height}" fill="#ffffff" />
                    <line x1="${yAxisX}" y1="${padTop}" x2="${yAxisX}" y2="${xAxisY}" stroke="rgba(26,26,26,0.25)" />
                    <line x1="${yAxisX}" y1="${xAxisY}" x2="${width - padRight}" y2="${xAxisY}" stroke="rgba(26,26,26,0.25)" />
                    ${yearLabels}
                    <polyline points="${points}" fill="none" stroke="rgba(245, 158, 11, 0.95)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                    ${pointDots}
                </svg>
                <div class="muted" style="margin-top: 0.5rem;">
                    ${minYear}${minYear !== maxYear ? `‚Äì${maxYear}` : ''} ‚Ä¢ lower rank is better
                </div>
            `;
        }

        function generateTrophyCabinet(playerId, tournaments) {
            const el = document.getElementById('trophy-cabinet-content');
            if (!el) return;

            const engine = window.tournamentEngine;
            const items = { 1: [], 2: [], 3: [] };

            const getFinish = (tournament) => {
                if (!tournament || !Array.isArray(tournament.final_standings)) return null;
                let idx = tournament.final_standings.findIndex(s => s.player === playerId);
                let isSharedHand = false;
                if (idx === -1) {
                    idx = tournament.final_standings.findIndex(s =>
                        s &&
                        s.is_partnership &&
                        Array.isArray(s.partnership_players) &&
                        s.partnership_players.some(p => p === playerId)
                    );
                    if (idx !== -1) {
                        isSharedHand = true;
                    }
                }
                if (idx === -1) return null;
                return { place: idx + 1, isSharedHand };
            };

            (tournaments || []).forEach(t => {
                const finish = getFinish(t);
                if (!finish) return;
                if (finish.place === 1 || finish.place === 2 || finish.place === 3) {
                    items[finish.place].push({ year: t.year });
                }
            });

            const total = items[1].length + items[2].length + items[3].length;
            if (!total) {
                el.innerHTML = `<div class="muted">Still waiting for their time to come.</div>`;
                return;
            }

            // Flatten into a single row: 1st (old->new), then 2nd, then 3rd
            const placeOrder = [
                { place: 1, emoji: 'üèÜ' },
                { place: 2, emoji: 'ü•à' },
                { place: 3, emoji: 'ü•â' }
            ];

            const flat = [];
            placeOrder.forEach(meta => {
                (items[meta.place] || [])
                    .slice()
                    .sort((a, b) => a.year - b.year)
                    .forEach(x => flat.push({ place: meta.place, emoji: meta.emoji, year: x.year }));
            });

            const trophies = flat.map(x => `
                <div class="trophy-piece trophy-piece--${x.place}">
                    <div class="trophy-piece-emoji">${x.emoji}</div>
                    <div class="trophy-piece-year">${x.year}</div>
                </div>
            `).join('');

            el.innerHTML = `
                <div class="trophy-row" role="list" aria-label="Trophy cabinet">
                    ${trophies}
                </div>
            `;
        }

        function generateTrumpSuitStats(playerName) {
            const engine = window.tournamentEngine;
            
            if (!engine || typeof engine.getPlayerTrumpSuitStats !== 'function') {
                console.error('‚ùå Tournament engine not available or missing trump suit methods');
                document.getElementById('trump-stats').innerHTML = '<p>Error loading trump suit statistics.</p>';
                return;
            }

            const trumpStats = engine.getPlayerTrumpSuitStats(playerName);
            
            const suitIcons = {
                'Hearts': '‚ô•',
                'Diamonds': '‚ô¶',
                'Spades': '‚ô†',
                'Clubs': '‚ô£'
            };
            
            const suitClasses = {
                'Hearts': 'heart',
                'Diamonds': 'diamond',
                'Spades': 'spade',
                'Clubs': 'club'
            };

            // Order: Hearts, Clubs, Diamonds, Spades
            const suitOrder = ['Hearts', 'Clubs', 'Diamonds', 'Spades'];
            
            const trumpHTML = suitOrder.map((suit, index) => {
                const stats = trumpStats[suit];
                const icon = suitIcons[suit];
                const cssClass = suitClasses[suit];
                const average = stats.rounds_played > 0 ? stats.average.toFixed(2) : '0.00';
                
                return `
                    <div class="trump-suit-row">
                        <span class="trump-suit-icon ${cssClass}">${icon}</span>
                        <span class="trump-suit-name">${suit}</span>
                        <span class="trump-average">${average}</span>
                    </div>
                    ${index < suitOrder.length - 1 ? '<div class="trump-divider"></div>' : ''}
                `;
            }).join('');

            document.getElementById('trump-stats').innerHTML = `
                <div class="trump-stats-list">
                    <div class="trump-title">avg tricks</div>
                    ${trumpHTML}
                </div>
            `;
        }

        function generateTournamentTimeline(player, tournaments) {
            // Use centralized calculation methods for caching compatibility
            const engine = window.tournamentEngine;
            const HISTORY_LIMIT = 10;
            if (typeof window.__showAllTournamentHistory !== 'boolean') {
                window.__showAllTournamentHistory = true; // default: show full history
            }
            
            if (!engine || typeof engine.getPositionEmoji !== 'function') {
                console.error('‚ùå Tournament engine not available or missing methods');
                document.getElementById('tournament-timeline').innerHTML = '<p>Error loading tournament history.</p>';
                return;
            }
            
            const sorted = (tournaments || []).slice().sort((a, b) => (b.year || 0) - (a.year || 0));
            const totalCount = sorted.length;
            const showingAll = window.__showAllTournamentHistory;
            const visible = showingAll ? sorted : sorted.slice(0, HISTORY_LIMIT);
            const range = window.__globalAvgTricksRange || { min: 0, max: 13 };
            const rangeMin = Number.isFinite(range.min) ? range.min : 0;
            const rangeMax = Number.isFinite(range.max) ? range.max : 13;
            const rangeSpan = rangeMax > rangeMin ? (rangeMax - rangeMin) : 1;

            const timelineHTML = visible
                .map(tournament => {
                    // Check for individual ranking first
                    let playerRanking = tournament.final_standings.findIndex(s => s.player === player.name) + 1;
                    let isSharedHand = false;
                    let partnershipName = null;
                    let tricksForDisplay = null; // For shared hands, use partnership total (not split)
                    let sharingWithText = null;
                    
                    // If not found individually, check shared hand partnerships
                    if (playerRanking === 0) {
                        const sharedHandEntry = tournament.final_standings.find(s => 
                            s.is_partnership && 
                            s.partnership_players && 
                            s.partnership_players.some(p => p === player.name)
                        );
                        
                        if (sharedHandEntry) {
                            playerRanking = tournament.final_standings.findIndex(s => s === sharedHandEntry) + 1;
                            isSharedHand = true;
                            partnershipName = sharedHandEntry.player;
                            const partners = Array.isArray(sharedHandEntry.partnership_players) ? sharedHandEntry.partnership_players : [];
                            const others = partners.filter(p => p && p.toLowerCase() !== player.name.toLowerCase());
                            const prettyOthers = others.map(p => (engine && typeof engine.getDisplayName === 'function') ? engine.getDisplayName(p) : p);
                            sharingWithText = prettyOthers.length ? prettyOthers.join(' & ') : null;
                            const sharedTricks = Number.isFinite(sharedHandEntry.total_tricks)
                                ? sharedHandEntry.total_tricks
                                : parseFloat(sharedHandEntry.total_tricks);
                            tricksForDisplay = Number.isFinite(sharedTricks) ? sharedTricks : null;
                        } else {
                            // Player not found in this tournament - should not happen but handle gracefully
                            playerRanking = null;
                        }
                    }
                    
                    const isWinner = tournament.winner === player.name;
                    const isTopThree = playerRanking <= 3 && playerRanking > 0;
                    const totalPlayers = tournament.final_standings.length;
                    
                    // Use centralized methods for calculations
                    const positionEmoji = engine.getPositionEmoji(playerRanking, totalPlayers);
                    const actualRounds = engine.getTournamentRoundsCount(tournament);
                    
                    // Avg tricks/round for the barometer:
                    // - Shared hand: use partnership total tricks (not split)
                    // - Solo: use engine helper
                    let avgTricksValue = null;
                    if (isSharedHand && Number.isFinite(tricksForDisplay) && actualRounds > 0) {
                        avgTricksValue = tricksForDisplay / actualRounds;
                    } else {
                        const avg = engine.getPlayerAverageTricksPerRound(player.name, tournament);
                        avgTricksValue = Number.isFinite(avg) ? avg : null;
                    }
                    const avgTricks = avgTricksValue === null ? null : avgTricksValue.toFixed(2);
                    const capped = avgTricksValue === null ? null : Math.max(rangeMin, Math.min(rangeMax, avgTricksValue));
                    const pctRaw = capped === null ? 0 : ((capped - rangeMin) / rangeSpan);
                    const pct = Math.max(0, Math.min(1, pctRaw));
                    const barPct = pct * 100;
                    const barTitle = avgTricksValue === null
                        ? 'Performance unavailable'
                        : `${avgTricks} avg tricks/round (range ${rangeMin.toFixed(2)}‚Äì${rangeMax.toFixed(2)})`;

                    return `
                        <a href="../tournaments/results.html?year=${tournament.year}" class="timeline-item timeline-item--compact ${isWinner ? 'winner' : isTopThree ? 'top-three' : ''}">
                            <span class="timeline-year">${tournament.year}</span>
                            <div class="timeline-line1">
                                <span class="timeline-tournament">${tournament.name}</span>
                                ${isSharedHand ? '<span class="shared-hand-badge">ü§ù Shared Hand</span>' : ''}
                                ${isSharedHand && sharingWithText ? `<span class="partnership-text">with: ${sharingWithText}</span>` : ''}
                            </div>
                            <div class="timeline-line2">
                                <div class="timeline-result">
                                    <span class="position-emoji">${positionEmoji}</span>
                                    <span class="result-position">${playerRanking ? `${playerRanking}${engine.getOrdinalSuffix(playerRanking)} Place` : 'Participated'}</span>
                                    ${isWinner ? '<span class="winner-badge">üèÜ Champion</span>' : ''}
                                </div>
                                <div class="timeline-performance-stack" title="${barTitle}">
                                    <div class="perf-label">${avgTricks === null ? '‚Äî' : `${avgTricks} avg/round`}</div>
                                    <div class="perf-bar" aria-hidden="true">
                                        <div class="perf-bar-mask" style="left:${barPct.toFixed(1)}%"></div>
                                        <div class="perf-bar-marker" style="left:${barPct.toFixed(1)}%"></div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                })
                .join('');
            
            document.getElementById('tournament-timeline').innerHTML = timelineHTML || '<p>No tournament history available.</p>';

            const meta = document.getElementById('tournament-timeline-meta');
            const toggleBtn = document.getElementById('toggle-tournament-history');
            if (meta) {
                if (!totalCount) {
                    meta.textContent = '';
                } else if (showingAll) {
                    meta.textContent = `Showing all ${totalCount} tournaments`;
                } else {
                    meta.textContent = `Showing latest ${Math.min(HISTORY_LIMIT, totalCount)} of ${totalCount} tournaments`;
                }
            }
            if (toggleBtn) {
                if (totalCount <= HISTORY_LIMIT) {
                    toggleBtn.style.display = 'none';
                    toggleBtn.onclick = null;
                } else {
                    toggleBtn.style.display = 'inline-flex';
                    toggleBtn.textContent = showingAll ? 'Show latest 10' : `Show all (${totalCount})`;
                    toggleBtn.onclick = () => {
                        window.__showAllTournamentHistory = !window.__showAllTournamentHistory;
                        generateTournamentTimeline(player, tournaments);
                    };
                }
            }
        }

        function computeGlobalAvgTricksRange(engine, tournaments) {
            const values = [];
            const list = Array.isArray(tournaments) ? tournaments : [];
            list.forEach(t => {
                if (!t || !Array.isArray(t.final_standings) || t.final_standings.length === 0) return;
                const rounds = (engine && typeof engine.getTournamentRoundsCount === 'function')
                    ? engine.getTournamentRoundsCount(t)
                    : 13;
                const denom = Number.isFinite(rounds) && rounds > 0 ? rounds : 13;

                t.final_standings.forEach(s => {
                    const tricks = Number.isFinite(s.total_tricks) ? s.total_tricks : parseFloat(s.total_tricks);
                    if (!Number.isFinite(tricks)) return;
                    const avg = tricks / denom;
                    if (!Number.isFinite(avg)) return;
                    values.push(avg);
                });
            });

            if (!values.length) {
                return { min: 0, max: 13, mean: 0, std: 0 };
            }

            const mean = values.reduce((sum, v) => sum + v, 0) / values.length;
            const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;
            const std = Math.sqrt(variance);

            const min = mean - (2 * std);
            const max = mean + (2 * std);

            if (!Number.isFinite(min) || !Number.isFinite(max) || max <= min) {
                return { min: 0, max: 13, mean, std: Number.isFinite(std) ? std : 0 };
            }

            return { min, max, mean, std };
        }

        // getOrdinalSuffix function moved to TournamentEngine class for centralized caching
    </script>
    
    <style>
        /* Player Profile Specific Styles */
        .player-hero {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--primary-dark) 100%);
            color: var(--text-primary);
            padding: var(--spacing-3xl) 0;
            position: relative;
            overflow: hidden;
        }

        .player-profile {
            display: flex;
            gap: var(--spacing-2xl);
            align-items: flex-start;
        }

        .player-avatar {
            position: relative;
            text-align: center;
        }

        .avatar-placeholder {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-card);
        }

        .avatar-icon {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .avatar-initial {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .champion-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a1a;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-full);
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .player-info {
            flex: 1;
        }

        .player-header {
            margin-bottom: var(--spacing-xl);
        }

        .player-name {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            line-height: 1.1;
        }

        .player-nickname {
            font-size: 1.25rem;
            font-style: italic;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        .player-title {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .player-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .meta-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .meta-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .family-tree-link {
            margin-bottom: var(--spacing-xl);
        }

        .family-tree-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .family-tree-btn:hover {
            background: var(--bg-accent);
        }

        .career-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-md);
        }

        /* Trophy cabinet (in header/hero) */
        .trophy-cabinet {
            margin-top: var(--spacing-lg);
            background: rgba(10, 26, 15, 0.55);
            border: 1px solid rgba(34, 197, 94, 0.35);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            position: relative;
            overflow: hidden;
        }

        .trophy-cabinet-label {
            font-size: 0.75rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            font-weight: 800;
            color: rgba(248, 250, 252, 0.9);
            margin-bottom: 0.6rem;
        }

        .trophy-cabinet-content .loading-message {
            color: rgba(248, 250, 252, 0.75);
        }

        .trophy-cabinet::after {
            content: '';
            position: absolute;
            left: var(--spacing-lg);
            right: var(--spacing-lg);
            bottom: 16px;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, rgba(34, 197, 94, 0.25) 20%, rgba(34, 197, 94, 0.25) 80%, transparent 100%);
            pointer-events: none;
        }

        .trophy-row {
            display: flex;
            gap: var(--spacing-lg);
            align-items: flex-end;
            justify-content: flex-start;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 18px; /* leaves room for shelf line */
            scrollbar-width: thin;
        }

        .trophy-piece {
            flex: 0 0 auto;
            width: 64px;
            text-align: center;
        }

        .trophy-piece-emoji {
            font-size: 2.6rem;
            line-height: 1;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.25));
            margin-bottom: 0.35rem;
        }

        .trophy-piece-year {
            font-weight: 700;
            font-size: 0.9rem;
            color: rgba(248, 250, 252, 0.85);
        }

        @media (max-width: 768px) {
            .trophy-piece {
                width: 56px;
            }
            .trophy-piece-emoji {
                font-size: 2.35rem;
            }
        }

        .highlight-card {
            background: var(--bg-secondary);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            box-shadow: var(--shadow-sm);
        }

        .highlight-card.primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: var(--text-primary);
        }

        .highlight-icon {
            font-size: 2rem;
        }

        .highlight-number {
            font-size: 2rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .highlight-label {
            font-size: 0.875rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .player-stats {
            padding: var(--spacing-3xl) 0;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, #f8fafc 50%, var(--bg-secondary) 100%);
            position: relative;
        }

        .player-stats::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(var(--primary-color-rgb), 0.03) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(var(--accent-color-rgb), 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .stats-grid {
            display: grid;
            gap: var(--spacing-2xl);
        }

        .stats-section {
            background: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-card);
            position: relative;
            z-index: 1;
        }

        .stats-section .section-title {
            color: var(--text-primary-dark);
            margin-bottom: var(--spacing-lg);
        }

        .stats-section .title-icon {
            color: var(--primary-color);
        }

        .stats-section.full-width {
            grid-column: 1 / -1;
        }

        .stats-table {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-light);
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: var(--text-secondary-dark);
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-primary-dark);
        }

        .chart-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            height: 400px;
        }

        .chart-container canvas {
            max-height: 100% !important;
        }

        .tournament-timeline {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .timeline-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .timeline-meta {
            color: var(--text-secondary-dark);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .timeline-toggle-btn {
            background: rgba(34, 197, 94, 0.12);
            border: 1px solid rgba(34, 197, 94, 0.28);
            color: var(--text-primary-dark);
            padding: 0.4rem 0.8rem;
            border-radius: 999px;
            font-weight: 800;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .timeline-toggle-btn:hover {
            background: rgba(34, 197, 94, 0.18);
            transform: translateY(-1px);
        }

        .timeline-item {
            display: block;
            padding: 0.85rem 1rem;
            background: white;
            border-radius: 14px;
            border: 1px solid rgba(34, 197, 94, 0.18);
            text-decoration: none;
            color: inherit;
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.05);
        }

        .timeline-item--compact {
            display: grid;
            grid-template-columns: 64px 1fr;
            grid-template-rows: auto auto;
            column-gap: 14px;
            row-gap: 6px;
            align-items: start;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .timeline-item:hover::before {
            transform: translateX(100%);
        }

        .timeline-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
            text-decoration: none;
            border-color: rgba(212, 175, 55, 0.5);
        }

        .timeline-item.winner {
            border-color: rgba(212, 175, 55, 0.55);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.10) 0%, rgba(255, 255, 255, 1) 80%);
        }

        .timeline-item.winner:hover {
            border-color: rgba(212, 175, 55, 0.75);
        }

        .timeline-item.top-three {
            border-color: rgba(34, 197, 94, 0.35);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.10) 0%, rgba(255, 255, 255, 1) 80%);
        }

        .timeline-year {
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--text-secondary-dark);
            text-align: left;
            grid-column: 1;
            grid-row: 1;
            line-height: 1.1;
            align-self: center;
        }

        .timeline-tournament {
            font-weight: 850;
            font-size: 1.18rem;
            color: #1a1a1a;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 0 1 auto;
            display: inline-block;
            max-width: clamp(220px, 48vw, 620px);
        }

        .timeline-line1 {
            display: flex;
            align-items: center;
            gap: 0.55rem;
            min-width: 0;
            grid-column: 2;
            grid-row: 1;
            align-self: center;
            justify-content: flex-start;
        }

        .timeline-line2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            grid-column: 2;
            grid-row: 2;
        }

        .timeline-result {
            display: flex;
            align-items: center;
            gap: 0.45rem;
            margin-bottom: 0;
            min-width: 0;
        }

        .result-position {
            font-weight: 800;
            font-size: 1.12rem;
            color: #2c3e50;
            white-space: nowrap;
        }

        .timeline-item.winner .timeline-year,
        .timeline-item.winner .result-position {
            color: #8b4513;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
        }

        .timeline-item.top-three .timeline-year,
        .timeline-item.top-three .result-position {
            color: #1565c0;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
        }

        .position-emoji {
            font-size: 1.05rem;
            margin-right: 0;
        }

        .winner-badge {
            background: rgba(212, 175, 55, 0.22);
            color: var(--text-primary-dark);
            padding: 0.18rem 0.6rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 900;
        }

        .timeline-performance-stack {
            width: 260px;
            display: flex;
            align-items: center;
            margin-left: auto; /* lock to same x position */
            position: relative;
            /* Keep a stable box height so the bar can be vertically centered */
            height: 26px;
        }

        .perf-bar {
            width: 100%;
            height: 10px;
            border-radius: 999px;
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.85) 0%, rgba(245, 158, 11, 0.85) 55%, rgba(34, 197, 94, 0.9) 100%);
            overflow: hidden;
            border: 1px solid rgba(26, 26, 26, 0.10);
            position: relative;
            /* Center bar within the stack regardless of label */
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .perf-bar-mask {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            /* left is set inline (same as marker percentage) */
            background: rgba(238, 238, 238, 0.92);
        }

        .perf-bar-marker {
            position: absolute;
            top: -2px;
            bottom: -2px;
            width: 2px;
            background: rgba(26, 26, 26, 0.55);
            transform: translateX(-1px);
            border-radius: 2px;
        }

        .perf-label {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--text-secondary-dark);
            white-space: nowrap;
            text-align: right;
            width: 100%;
            /* Float above the bar without affecting layout */
            position: absolute;
            right: 0;
            bottom: calc(50% + 9px);
            line-height: 1;
        }

        .loading-message {
            text-align: center;
            color: var(--text-secondary-dark);
            padding: var(--spacing-xl);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .player-profile {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .player-name {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .timeline-item {
                padding: 0.85rem 0.9rem;
            }

            .timeline-year {
                font-size: 1.1rem;
            }

            .timeline-tournament {
                font-size: 0.98rem;
            }

            .timeline-line2 {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .timeline-performance-stack {
                width: 100%;
                max-width: none;
                align-self: stretch;
                margin-left: 0;
            }

            .perf-bar {
                width: 100%;
            }
        }

        .shared-hand-badge {
            background: rgba(59, 130, 246, 0.10);
            color: #1d4ed8;
            padding: 0.18rem 0.55rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 900;
            border: 1px solid rgba(59, 130, 246, 0.22);
            flex: 0 0 auto;
        }

        .partnership-text {
            color: var(--text-secondary-dark);
            font-size: 0.9rem;
            font-weight: 800;
            white-space: nowrap;
            flex: 0 0 auto;
        }
    </style>
</body>
</html> 